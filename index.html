<!DOCTYPE html>
<html lang="nl">

<head>
    <title>Calculator</title>
    <link rel="icon" type="image/png" href="https://cdn.jim-nielsen.com/ios/512/calculator-2017-10-10.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
        let bigResult = "Er was nog geen resultaat om te kopiÃ«ren!";
        let resizeTimeout;

        window.addEventListener('load', () => {
            window.addEventListener("resize", () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(setBackground, 200);
            });
            appInit();
            setBackground();
        });

        function appInit() {
            if (typeof(Storage) !== "undefined") {
                var storedResultaat = localStorage.getItem('resultaat');
                var storedGetal1 = localStorage.getItem('getal1');
                var storedGetal2 = localStorage.getItem('getal2');
                
                if (Number.isNaN(Number(storedResultaat)) || Number.isNaN(Number(storedGetal1)) || Number.isNaN(Number(storedGetal2))) {
                    storedResultaat = "";
                    storedGetal1 = "";
                    storedGetal2 = "";
                    localStorage.removeItem('getal1');
                    localStorage.removeItem('getal2');
                    localStorage.removeItem('resultaat');
                }

                document.getElementById("getal1").value = storedGetal1;
                document.getElementById("getal2").value = storedGetal2;
                document.getElementById("resultaat").value = storedResultaat;

                if (storedResultaat !== "" && storedResultaat !== null) {
                    bigResult = storedResultaat;
                    if (storedResultaat >= 0) {
                        document.getElementById("resultaat").style.borderColor = 'green';
                        document.getElementById("resultaat").style.backgroundColor = 'rgb(150, 255, 150)';
                    } else {
                        document.getElementById("resultaat").style.borderColor = 'red';
                        document.getElementById("resultaat").style.backgroundColor = 'rgb(255, 150, 150)';
                    }

                    if (!Number.isNaN(storedResultaat)) {
                        document.getElementById("resultaat").value = normalizeNumber(storedResultaat.toString()) + " %";
                    } else {
                        resetResult();
                    }
                }
            }
        }

        function berekenen() {
            var getal1 = document.getElementById("getal1").value;
            var getal2 = document.getElementById("getal2").value;

            document.getElementById("getal1").value = normalizeNumber(getal1);
            document.getElementById("getal2").value = normalizeNumber(getal2);

            var resultaat = Number();

            if (getal1 !== "" && getal2 !== "" && !Number.isNaN(Number(getal1)) && !Number.isNaN(getal2)) {
                getal1 = Number(normalizeNumber(getal1));
                getal2 = Number(normalizeNumber(getal2));

                if (getal1 === 0) {
                    resetResult();
                    return;
                }

                resultaat = ((getal2 - getal1) / getal1) * 100;
                resultaat = Math.round(resultaat * 100 + Number.EPSILON) / 100
                bigResult = resultaat.toString();

                if (resultaat >= 0) {
                    document.getElementById("resultaat").style.borderColor = 'green';
                    document.getElementById("resultaat").style.backgroundColor = 'rgb(150, 255, 150)';
                } else {
                    document.getElementById("resultaat").style.borderColor = 'red';
                    document.getElementById("resultaat").style.backgroundColor = 'rgb(255, 150, 150)';
                }
                
                if (!Number.isNaN(resultaat)) {
                    document.getElementById("resultaat").value = normalizeNumber(resultaat.toString()) + " %";
                } else {
                    resetResult();
                }
            } else {
                resetResult();
            }
            localStorage.setItem('getal1', getal1);
            localStorage.setItem('getal2', getal2);
            localStorage.setItem('resultaat', resultaat);
        }

        function normalizeNumber(value) {
            if (typeof value !== 'string') value = String(value);
            value = value.replace(/[^\d.,-]/g, '');
            const minusCount = (value.match(/-/g) || []).length;
            if (minusCount > 0) {
                value = value.replace(/-/g, '');
                value = '-' + value;
            }
            value = value.replace(/,/g, '.');
            const parts = value.split('.');
            if (parts.length > 1) {
                const integerPart = parts[0];
                const decimalPart = parts.slice(1).join('');
                value = integerPart + '.' + decimalPart;
            }
            if (value.includes('-') && !value.startsWith('-')) {
                value = value.replace(/-/g, '');
                value = '-' + value;
            }
            return value;
        }

        function resetResult() {
            document.getElementById("resultaat").value = "";
            document.getElementById("resultaat").style.borderColor = 'dimgrey';
            document.getElementById("resultaat").style.backgroundColor = 'white';
        }

        async function copyMessage() {
            let copySuccess = false;
            try {
                await navigator.clipboard.writeText(bigResult);
                copySuccess = true;
                return true;
            } catch {
                copySuccess = false;
                return false;
            }
        }

        function preventTouchMove(e) {
            e.preventDefault();
        }

        function handleFocusOut(event) {
            if (event.target.matches('input[type="text"]')) {
                scrollToBackgroundFill();
            }
        }

        function scrollToBackgroundFill() {
            setTimeout(() => {
                window.scrollTo(0, 100);
            }, 50);
        }

        function setBackground() {
            const width = Math.min(window.innerWidth, 2000);
            const height = Math.min(window.innerHeight, 2000);
            fetch(`https://picsum.photos/${width}/${height}`)
                .then(res => {
                    const url = `url(${res.url})`;
                    document.documentElement.style.backgroundImage = url;
                    document.documentElement.style.backgroundSize = 'cover';
                    document.documentElement.style.backgroundPosition = 'center';
            }).catch(() => {
                document.documentElement.style.backgroundImage = "none";
                document.documentElement.style.backgroundColor = "#000";
            });
            if (width < 600) {
                document.addEventListener("touchmove", preventTouchMove, { passive: false });
                document.addEventListener("focusout", handleFocusOut);
                scrollToBackgroundFill();
            } else {
                document.removeEventListener("touchmove", preventTouchMove, { passive: false });
                document.removeEventListener("focusout", handleFocusOut);
            }
        }
    </script>
    <style>
        html {
            margin: 0;
            padding: 0;
            min-height: 100svh;
            width: 100%;
            text-align: center;
            font-family: Tahoma, Geneva, sans-serif;
            color: rgb(50, 50, 50);
            background-color: #000;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        body {
            min-height: 100%;
            margin: 0;
        }

        h1 {
            margin: 0;
            margin-bottom: 50px;
            text-shadow: 0 0 2px #FFF;
            -moz-text-shadow: 0 0 2px #FFF;
            -webkit-text-shadow: 0 0 2px #FFF;
        }

        input {
            border: 3px solid dimgrey;
            width: 300px;
            height: 40px;
            font-size: 30px;
            text-align: center;
            color: rgb(80, 80, 80);
            border-radius: 10px;
            margin-bottom: 40px;
        }

        #resultaat {
            font-weight: 550;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            cursor: default;
            pointer-events: none;
        }

        #voorgrond {
            text-align: center;
            background-color: rgba(255, 255, 255, 0.7);
            display: inline-block;
            margin: 100px;
            padding: 50px;
            border-radius: 30px;
        }

        label {
            font-weight: 600;
            font-size: 18px;
            display: block;
            margin-bottom: 14px;
            text-shadow: 0 0 2px #FFF;
            -moz-text-shadow: 0 0 2px #FFF;
            -webkit-text-shadow: 0 0 2px #FFF;
        }

        #resultaat {
            margin-bottom: 20px;
        }

        .resultaatLabel {
            margin-top: 10px;
        }

        #copy-btn {
            background-color: white;
            color: #333;
            padding: 1em 2em;
            border-radius: 12px;
            border: 3px solid dimgrey;
        }

        @media only screen and (max-width: 600px) {
            html {
                background-position: center top;
            }

            h1 {
                padding: 60px 20px 40px 20px;
                margin: 0px;
                font-size: 26px;
            }

            input {
                width: 75%;
                height: 28px;
                font-size: 28px;
                margin-bottom: 14px;
            }

            .resultaatLabel {
                margin-top: 10px;
            }

            #voorgrond {
                width: 100%;
                height: 100svh;
                border-radius: 0px;
                padding: 0;
                margin: 0;
                background-color: rgba(200, 200, 200, 0.6);
                padding-top: 100px;
                padding-bottom: 100px;
            }

            label {
                font-size: 18px;
                margin-bottom: 4px;
            }
        }

        @media only screen and (min-width: 600px) and (max-height: 800px) {
            #voorgrond {
                margin: 2em;
                padding: 40px;
            }

            h1 {
                margin-bottom: 30px;
            }
        }
    </style>
</head>

<body>
    <div class="layer"></div>
    <div id="voorgrond">
        <h1>Wat is het percentage toename of afname?</h1><br>
        <label>Van</label>
        <input
            type="text"
            inputmode="decimal"
            pattern="[0-9.,]*"
            id="getal1"
            name="getal1"
            oninput="berekenen()"
        >
        <br>
        <label>Naar</label>
        <input
            type="text"
            inputmode="decimal"
            pattern="[0-9.,]*"
            id="getal2"
            name="getal2"
            oninput="berekenen()"
        >
        <br><br>
        <label class="resultaatLabel">Resultaat</label>
        <input id="resultaat" readonly disabled>
        <br><br><button id="copy-btn" onclick="copyMessage() ? this.innerText='Resultaat gekopieerd!' : this.innerText='Oops, er ging iets mis!'">Kopieer resultaat</button>
    </div>
</body>

</html>